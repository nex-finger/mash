; ipl
; TAB=4

		ORG		0x7c00			; このプログラムがどこに読み込まれるのか

		JMP		iplEntry

; --- プログラム本体 ---

; --- レジスタ初期化 ---
iplEntry:
		MOV		AX, 0x0000		; 0に初期化
		MOV		SS, AX
		MOV		SP, 0x7c00
		MOV		DS, AX

; --- タイマ初期化 ---
		MOV		AH, 0x01
		MOV		CX, 0x0000		; 0に初期化
		MOV		DX, 0x0000
		INT		0x1a
		
; --- ビデオモード指定 ---
		MOV		AH, 0x00
		MOV		AL, 0x07
		INT		0x10

; --- テスト文字列出力 ---
		MOV		AH, 0x13
		MOV		AL, 0x01
		MOV		BH, 0x00
		MOV		BL, 0x0f
		MOV		CX, 0x0016
		MOV		DX, 0x0000
		PUSH	CS
		POP		ES
		MOV		BP, iplInitMsg
		INT		0x10

; --- セカンダリローダ用意 ---
		MOV		BX, 0x1000		; 0X01:8000に展開
		MOV		ES, BX
		MOV		BX, 0x8000
		MOV		AH, 0x02
		MOV		AL, 0x04		; セカンダリローダは4セクタ
		MOV		CH, 0x00		; シリンダ0
		MOV		CL, 0x02		; セクタ2
		MOV		DH, 0x00		; ヘッド0
		MOV		DL, 0x00		; ドライブA
		INT		0x13
		JC		iplErr			; 失敗
		JMP		0x1000:0x8000	; 成功

; --- ロード失敗 ---
iplErr:
		MOV		AH, 0x13
		MOV		AL, 0x01
		MOV		BH, 0x00
		MOV		BL, 0x0f
		MOV		CX, 0x0015
		MOV		DX, 0x0000
		PUSH	CS
		POP		ES
		MOV		BP, iplErrMsg
		INT		0x10
		JMP		iplEnd

iplConsole:
		JMP		iplEnd

; --- ループ ---
iplEnd:
		JMP		iplEnd

; --- テスト文字列 ---
iplInitMsg:
		; "Power on detection!!\r\n"
		DB 		0x50, 0x6F, 0x77, 0x65, 0x72, 0x20, 0x6F, 0x6E
		DB		0x20, 0x64, 0x65, 0x74, 0x65, 0x63, 0x74, 0x69
		DB		0x6F, 0x6E, 0x21, 0x21, 0x0D, 0x0A

iplErrMsg:
		; "Disk read failed...\r\n"
		DB		0x44, 0x69, 0x73, 0x6B, 0x20, 0x72, 0x65, 0x61
		DB		0x64, 0x20, 0x66, 0x61, 0x69, 0x6C, 0x65, 0x64
		DB		0x2E, 0x2E, 0x2E, 0x0D, 0x0A

; --- ブートローダーシグネチャ ---
		times 510-($-$$) DB 0
		DW		0xaa55			; シグネチャ